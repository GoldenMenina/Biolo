"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[582],{2994:function(e,n,t){t.d(n,{Z:function(){return h}});var r=t(9499),a=t(29),s=t(7794),o=t.n(s),i=t(7294),c=t(7066),l=t(538),d=t(5893);function u(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?u(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function h(e){var n=e.show,t=e.onClose,s=e.clienteEditado,u=e.onSave,h=(0,i.useState)({nome:"",telemovel:"",segmento_de_cliente_id:""}),p=h[0],x=h[1],j=(0,i.useState)([]),f=j[0],b=j[1],v=(0,i.useState)(!1),g=v[0],N=v[1];function y(e){var n=e.target,t=n.name,a=n.value;x((function(e){return m(m({},e),{},(0,r.Z)({},t,a))}))}function _(){return(_=(0,a.Z)(o().mark((function e(n){var r,a,i,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),N(!0),e.prev=2,!s){e.next=12;break}return e.next=6,c.O.from("Cliente").update({nome:p.nome,telemovel:p.telemovel,segmento_de_cliente_id:p.segmento_de_cliente_id}).eq("id",p.id);case 6:if(r=e.sent,!(a=r.error)){e.next=10;break}throw a;case 10:e.next=18;break;case 12:return e.next=14,c.O.from("Cliente").insert([p]);case 14:if(i=e.sent,!(l=i.error)){e.next=18;break}throw l;case 18:u(),t(),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(2),console.error(e.t0),alert("Erro ao salvar cliente.");case 26:N(!1);case 27:case"end":return e.stop()}}),e,null,[[2,22]])})))).apply(this,arguments)}return(0,i.useEffect)((function(){x(s||{nome:"",telemovel:"",segmento_de_cliente_id:""})}),[s]),(0,i.useEffect)((function(){function e(){return(e=(0,a.Z)(o().mark((function e(){var n,t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.O.from("SegmentoDeClientes").select("*");case 2:n=e.sent,t=n.data,n.error||b(t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),n?(0,d.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,d.jsx)("div",{className:"modal-dialog",children:(0,d.jsxs)("div",{className:"modal-content",children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h5",{className:"modal-title",children:s?"Editar Cliente":"Novo Cliente"}),(0,d.jsx)("button",{className:"btn-close",onClick:t})]}),(0,d.jsx)("div",{className:"modal-body",children:g?(0,d.jsx)(l.Z,{}):(0,d.jsxs)("form",{onSubmit:function(e){return _.apply(this,arguments)},children:[(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsx)("label",{className:"form-label",children:"Nome"}),(0,d.jsx)("input",{type:"text",name:"nome",className:"form-control",value:p.nome,onChange:y,required:!0})]}),(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsx)("label",{className:"form-label",children:"Telefone"}),(0,d.jsx)("input",{type:"text",name:"telemovel",className:"form-control",value:p.telemovel,onChange:y,required:!0})]}),(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsx)("label",{className:"form-label",children:"Segmento de Cliente"}),(0,d.jsxs)("select",{name:"segmento_de_cliente_id",className:"form-select",value:p.segmento_de_cliente_id,onChange:y,required:!0,children:[(0,d.jsx)("option",{value:"",children:"Selecione"}),f.map((function(e){return(0,d.jsx)("option",{value:e.id,children:e.designacao},e.id)}))]})]}),(0,d.jsxs)("div",{className:"mt-3",children:[(0,d.jsx)("button",{type:"submit",className:"btn btn-success me-2",children:"Salvar"}),(0,d.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:t,children:"Cancelar"})]})]})})]})})}):null}},3e3:function(e,n,t){t.d(n,{Z:function(){return d}});var r=t(29),a=t(7794),s=t.n(a),o=t(7294),i=t(7066),c=t(538),l=t(5893);function d(e){var n=e.onEdit,t=(0,o.useState)([]),a=t[0],d=t[1],u=(0,o.useState)(!0),m=u[0],h=u[1],p=(0,o.useState)(""),x=p[0],j=p[1];function f(){return b.apply(this,arguments)}function b(){return(b=(0,r.Z)(s().mark((function e(){var n,t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),e.next=3,i.O.from("Cliente").select("\n        id,\n        nome,\n        telemovel,\n        segmento:segmento_de_cliente_id(designacao)\n      ");case 3:n=e.sent,t=n.data,(r=n.error)?console.error("Erro ao carregar clientes:",r):d(t),h(!1);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){return(v=(0,r.Z)(s().mark((function e(n){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("Deseja eliminar este cliente?")){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,i.O.from("Cliente").delete().eq("id",n);case 4:t=e.sent,(r=t.error)?console.error("Erro ao deletar:",r):f();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,o.useEffect)((function(){f()}),[]);var g=a.filter((function(e){return e.nome.toLowerCase().includes(x.toLowerCase())||e.telemovel.includes(x)}));return m?(0,l.jsx)(c.Z,{}):(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"d-flex justify-content-between mb-3",children:(0,l.jsx)("input",{type:"text",className:"form-control w-50",placeholder:"Buscar por nome ou telefone",value:x,onChange:function(e){return j(e.target.value)}})}),(0,l.jsx)("div",{className:"table-responsive",children:(0,l.jsxs)("table",{className:"table table-striped align-middle",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Nome"}),(0,l.jsx)("th",{children:"Telefone"}),(0,l.jsx)("th",{children:"Segmento"}),(0,l.jsx)("th",{children:"A\xe7\xf5es"})]})}),(0,l.jsx)("tbody",{children:g.map((function(e){var t;return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.nome}),(0,l.jsx)("td",{children:e.telemovel}),(0,l.jsx)("td",{children:(null===(t=e.segmento)||void 0===t?void 0:t.designacao)||"\u2014"}),(0,l.jsxs)("td",{children:[(0,l.jsx)("button",{className:"btn btn-sm btn-warning me-2",onClick:function(){return n(e)},children:"Editar"}),(0,l.jsx)("button",{className:"btn btn-sm btn-danger",onClick:function(){return function(e){return v.apply(this,arguments)}(e.id)},children:"Eliminar"})]})]},e.id)}))})]})})]})}},538:function(e,n,t){t.d(n,{Z:function(){return a}});var r=t(5893);function a(){return(0,r.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:(0,r.jsx)("div",{className:"spinner-border text-primary",role:"status"})})}},3042:function(e,n,t){t.d(n,{Z:function(){return d}});var r=t(29),a=t(7794),s=t.n(a),o=t(7294),i=t(7066),c=t(538),l=t(5893);function d(e){var n,t,a,d,u,m=e.show,h=e.orderId,p=e.onClose,x=(0,o.useState)(null),j=x[0],f=x[1],b=(0,o.useState)([]),v=b[0],g=b[1],N=(0,o.useState)(!0),y=N[0],_=N[1];function Z(){return(Z=(0,r.Z)(s().mark((function e(n){var t,r,a,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(!0),e.next=3,i.O.from("Encomenda").select("\n        *,\n        status:status_da_encomenda_id(designacao),\n        endereco: endereco_id (\n          etiqueta,\n          referencia_geografica,\n          cliente:cliente_id ( nome )\n        )\n      ").eq("id",n).single();case 3:return t=e.sent,r=t.data,e.next=7,i.O.from("ProdutoEncomendado").select("\n        quantidade_encomendada,\n        preco:preco_de_produto_id (\n          preco_unitario,\n          produto:produto_id (\n            designacao\n          )\n        )\n      ").eq("encomenda_id",n);case 7:a=e.sent,o=a.data,f(r),g(o||[]),_(!1);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,o.useEffect)((function(){m&&h&&function(e){Z.apply(this,arguments)}(h)}),[m,h]),m&&h?y?(0,l.jsx)(c.Z,{}):(0,l.jsx)("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:(0,l.jsx)("div",{className:"modal-dialog modal-lg",children:(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsxs)("h5",{className:"modal-title",children:["Detalhes da Encomenda #",j.id]}),(0,l.jsx)("button",{className:"btn-close",onClick:p})]}),(0,l.jsxs)("div",{className:"modal-body",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Cliente:"})," ",null===(n=j.endereco)||void 0===n||null===(t=n.cliente)||void 0===t?void 0:t.nome]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Telefone:"})," ",j.contacto_telemovel]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Status:"})," ",null===(a=j.status)||void 0===a?void 0:a.designacao]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Data de Emiss\xe3o:"})," ",new Date(j.data_de_emissao).toLocaleDateString()]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Endere\xe7o:"})," ",null===(d=j.endereco)||void 0===d?void 0:d.etiqueta," (",null===(u=j.endereco)||void 0===u?void 0:u.referencia_geografica,")"]}),(0,l.jsx)("h6",{className:"mt-4",children:"Produtos:"}),(0,l.jsx)("div",{className:"table-responsive",children:(0,l.jsxs)("table",{className:"table table-bordered",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Produto"}),(0,l.jsx)("th",{children:"Quantidade"}),(0,l.jsx)("th",{children:"Pre\xe7o Unit\xe1rio"}),(0,l.jsx)("th",{children:"Total"})]})}),(0,l.jsx)("tbody",{children:v.map((function(e,n){var t,r,a,s;return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:null===(t=e.preco)||void 0===t||null===(r=t.produto)||void 0===r?void 0:r.designacao}),(0,l.jsx)("td",{children:e.quantidade_encomendada}),(0,l.jsx)("td",{children:null===(a=e.preco)||void 0===a?void 0:a.preco_unitario}),(0,l.jsx)("td",{children:(e.quantidade_encomendada*parseFloat((null===(s=e.preco)||void 0===s?void 0:s.preco_unitario)||0)).toFixed(2)})]},n)}))})]})})]})]})})}):null}},2338:function(e,n,t){t.d(n,{Z:function(){return d}});var r=t(29),a=t(7794),s=t.n(a),o=t(7294),i=t(7066),c=t(538),l=t(5893);function d(e){var n=e.onView,t=(0,o.useState)([]),a=t[0],d=t[1],u=(0,o.useState)(!0),m=u[0],h=u[1];function p(){return(p=(0,r.Z)(s().mark((function e(){var n,t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),e.next=3,i.O.from("Encomenda").select("\n        id,\n        contacto_telemovel,\n        data_de_emissao,\n        status:status_da_encomenda_id(designacao),\n        endereco: endereco_id (\n          etiqueta,\n          cliente:cliente_id (\n            nome\n          )\n        )\n      ");case 3:n=e.sent,t=n.data,(r=n.error)?console.error("Erro ao buscar encomendas:",r):d(t),h(!1);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,o.useEffect)((function(){!function(){p.apply(this,arguments)}()}),[]),m?(0,l.jsx)(c.Z,{}):(0,l.jsx)("div",{className:"table-responsive",children:(0,l.jsxs)("table",{className:"table table-striped align-middle",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"ID"}),(0,l.jsx)("th",{children:"Cliente"}),(0,l.jsx)("th",{children:"Telefone"}),(0,l.jsx)("th",{children:"Data"}),(0,l.jsx)("th",{children:"Status"}),(0,l.jsx)("th",{children:"A\xe7\xf5es"})]})}),(0,l.jsx)("tbody",{children:a.map((function(e){var t,r,a;return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.id}),(0,l.jsx)("td",{children:(null===(t=e.endereco)||void 0===t||null===(r=t.cliente)||void 0===r?void 0:r.nome)||"\u2014"}),(0,l.jsx)("td",{children:e.contacto_telemovel}),(0,l.jsx)("td",{children:new Date(e.data_de_emissao).toLocaleDateString()}),(0,l.jsx)("td",{children:(0,l.jsx)("span",{className:"badge bg-info",children:null===(a=e.status)||void 0===a?void 0:a.designacao})}),(0,l.jsx)("td",{children:(0,l.jsx)("button",{className:"btn btn-sm btn-primary",onClick:function(){return n(e.id)},children:"Ver Detalhes"})})]},e.id)}))})]})})}},5308:function(e,n,t){t.d(n,{Z:function(){return N}});var r=t(9499),a=t(29),s=t(7794),o=t.n(s),i=t(7294),c=t(7359),l=t(6968),d=t(2914),u=t(1608),m=t(1555),h=t(3680),p=t(7066),x=t(5893),j=t(4155);function f(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function b(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?f(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function v(e,n){return g.apply(this,arguments)}function g(){return(g=(0,a.Z)(o().mark((function e(n,t){var r,a,s,i,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"dbagu0ju8",r=j.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,(a=new FormData).append("file",n),a.append("cloud_name","dbagu0ju8"),a.append("upload_preset",r),e.prev=6,e.next=9,fetch("https://api.cloudinary.com/v1_1/dbagu0ju8/image/upload",{method:"POST",body:a});case 9:if(s=e.sent,console.log(s),s.ok){e.next=16;break}return e.next=14,s.json();case 14:throw i=e.sent,new Error("Cloudinary upload failed: ".concat(s.statusText,". Details: ").concat(JSON.stringify(i)));case 16:return e.next=18,s.json();case 18:return c=e.sent,e.abrupt("return",c.secure_url);case 22:return e.prev=22,e.t0=e.catch(6),console.error("Error uploading to Cloudinary:",e.t0),t("Erro ao fazer upload da imagem: ".concat(e.t0.message)),e.abrupt("return",null);case 27:case"end":return e.stop()}}),e,null,[[6,22]])})))).apply(this,arguments)}function N(e){var n=e.show,t=e.onClose,s=e.produtoEditado,j=e.onSave,f=(0,i.useState)({produto_id:null,nome:"",preco:"",categoria:"",image:"",tipo_corte:"",quantidade_estoque:0,activo:!1}),g=f[0],N=f[1],y=(0,i.useState)(!1),_=y[0],Z=(y[1],(0,i.useState)(!1)),w=Z[0],C=Z[1],k=(0,i.useState)(!1),O=k[0],S=k[1],E=(0,i.useState)(""),q=E[0],P=E[1],D=(0,i.useState)(""),I=D[0],A=D[1],F=(0,i.useRef)(null),L=(0,i.useState)(null),T=L[0],z=L[1];(0,i.useEffect)((function(){n&&(P(""),S(!1),s?(N({produto_id:s.produto_id,nome:s.nome||"",preco:s.preco||"",categoria:s.categoria||"",image:s.image||"",tipo_corte:s.tipo_corte||"",quantidade_estoque:s.quantidade_estoque||0,activo:void 0===s.activo||s.activo}),A(s.image||"")):(N({produto_id:null,nome:"",preco:"",categoria:"",image:"",tipo_corte:"",quantidade_estoque:0,activo:!1}),A("")),z(null),F.current&&(F.current.value=""))}),[s,n]);var G=function(e){var n=e.target,t=n.name,a=n.value,s=n.type,o=n.checked;N((function(e){return b(b({},e),{},(0,r.Z)({},t,"checkbox"===s?o:a))})),S(!1),P("")},R=function(){var e=(0,a.Z)(o().mark((function e(n){var r,a,i,c,l,d,u,m,h,x,f,b,N,y,_,Z;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),P(""),C(!0),r=g.nome,a=g.preco,i=g.categoria,c=g.tipo_corte,l=g.quantidade_estoque,d=g.activo,r.trim()){e.next=8;break}return P("O nome do produto \xe9 obrigat\xf3rio."),C(!1),e.abrupt("return");case 8:if(u=parseFloat(a),!(isNaN(u)||u<0)){e.next=13;break}return P("O pre\xe7o deve ser um n\xfamero positivo."),C(!1),e.abrupt("return");case 13:if(m=parseInt(l),!(isNaN(m)||m<0)){e.next=18;break}return P("A quantidade em estoque deve ser um n\xfamero n\xe3o negativo."),C(!1),e.abrupt("return");case 18:if(i.trim()){e.next=22;break}return P("A categoria do produto \xe9 obrigat\xf3ria."),C(!1),e.abrupt("return");case 22:if(h=g.image,!T){e.next=31;break}return e.next=26,v(T,P);case 26:if(x=e.sent){e.next=30;break}return C(!1),e.abrupt("return");case 30:h=x;case 31:if(f={nome:r,preco:parseFloat(a),categoria:i,image:h,tipo_corte:c,quantidade_estoque:parseInt(l),activo:d},b=null,!s){e.next=41;break}return e.next=36,p.O.from("produtos").update(f).eq("produto_id",g.produto_id);case 36:N=e.sent,y=N.error,b=y,e.next=46;break;case 41:return e.next=43,p.O.from("produtos").insert([f]);case 43:_=e.sent,Z=_.error,b=Z;case 46:b?(console.error("Erro ao salvar produto:",b),P("Erro ao salvar produto: ".concat(b.message))):(S(!0),j&&j(),setTimeout((function(){t()}),1e3)),C(!1);case 48:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,x.jsxs)(c.Z,{show:n,onHide:t,size:"lg",centered:!0,backdrop:"static",children:[(0,x.jsx)(c.Z.Header,{closeButton:!0,className:"bg-light border-bottom-0",children:(0,x.jsx)(c.Z.Title,{className:"text-primary",children:s?"Editar Produto":"Novo Produto"})}),_?(0,x.jsx)("div",{className:"d-flex justify-content-center align-items-center py-5",children:(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)(l.Z,{animation:"border",variant:"primary",role:"status",style:{width:"3rem",height:"3rem"}}),(0,x.jsx)("p",{className:"mt-3 text-muted",children:"Carregando..."})]})}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.Z.Body,{className:"pt-0 px-4",children:(0,x.jsxs)(d.Z,{id:"productForm",onSubmit:R,children:[O&&(0,x.jsxs)("div",{className:"alert alert-success mt-3 d-flex align-items-center",children:[(0,x.jsx)("i",{className:"bi bi-check-circle-fill me-2"}),(0,x.jsxs)("span",{children:["Produto ",s?"atualizado":"criado"," com sucesso!"]})]}),q&&(0,x.jsxs)("div",{className:"alert alert-danger mt-3 d-flex align-items-center",children:[(0,x.jsx)("i",{className:"bi bi-exclamation-triangle-fill me-2"}),(0,x.jsx)("span",{children:q})]}),(0,x.jsxs)("div",{className:"card border-0 shadow-sm rounded mt-3 mb-4",children:[(0,x.jsx)("div",{className:"card-header bg-light py-2",children:(0,x.jsx)("h6",{className:"mb-0",children:"Informa\xe7\xf5es do Produto"})}),(0,x.jsxs)("div",{className:"card-body pt-3",children:[(0,x.jsxs)(u.Z,{children:[(0,x.jsx)(m.Z,{md:6,children:(0,x.jsxs)(d.Z.Group,{className:"mb-3",children:[(0,x.jsxs)(d.Z.Label,{className:"fw-medium",children:["Nome ",(0,x.jsx)("span",{className:"text-danger",children:"*"})]}),(0,x.jsx)(d.Z.Control,{type:"text",name:"nome",value:g.nome,onChange:G,required:!0,className:"border-secondary-subtle",placeholder:"Nome do produto"})]})}),(0,x.jsx)(m.Z,{md:6,children:(0,x.jsxs)(d.Z.Group,{className:"mb-3",children:[(0,x.jsxs)(d.Z.Label,{className:"fw-medium",children:["Pre\xe7o ",(0,x.jsx)("span",{className:"text-danger",children:"*"})]}),(0,x.jsx)(d.Z.Control,{type:"number",name:"preco",value:g.preco,onChange:G,required:!0,min:"0",step:"0.01",className:"border-secondary-subtle",placeholder:"0.00"}),(0,x.jsx)(d.Z.Text,{className:"text-muted",children:"Pre\xe7o unit\xe1rio do produto"})]})})]}),(0,x.jsxs)(u.Z,{children:[(0,x.jsx)(m.Z,{md:6,children:(0,x.jsxs)(d.Z.Group,{className:"mb-3",children:[(0,x.jsxs)(d.Z.Label,{className:"fw-medium",children:["Categoria ",(0,x.jsx)("span",{className:"text-danger",children:"*"})]}),(0,x.jsx)(d.Z.Control,{type:"text",name:"categoria",value:g.categoria,onChange:G,required:!0,className:"border-secondary-subtle",placeholder:"Ex: Frutas, Legumes, Carnes"})]})}),(0,x.jsx)(m.Z,{md:6,children:(0,x.jsxs)(d.Z.Group,{className:"mb-3",children:[(0,x.jsx)(d.Z.Label,{className:"fw-medium",children:"Tipo de Corte"}),(0,x.jsx)(d.Z.Control,{type:"text",name:"tipo_corte",value:g.tipo_corte,onChange:G,className:"border-secondary-subtle",placeholder:"Ex: Cubos, Fatias, Inteiro"})]})})]}),(0,x.jsxs)(u.Z,{children:[(0,x.jsx)(m.Z,{md:6,children:(0,x.jsxs)(d.Z.Group,{className:"mb-3",children:[(0,x.jsxs)(d.Z.Label,{className:"fw-medium",children:["Quantidade em Estoque ",(0,x.jsx)("span",{className:"text-danger",children:"*"})]}),(0,x.jsx)(d.Z.Control,{type:"number",name:"quantidade_estoque",value:g.quantidade_estoque,onChange:G,required:!0,min:"0",className:"border-secondary-subtle",placeholder:"0"}),(0,x.jsx)(d.Z.Text,{className:"text-muted",children:"Quantidade dispon\xedvel no estoque"})]})}),(0,x.jsx)(m.Z,{md:6,children:(0,x.jsxs)(d.Z.Group,{className:"mb-3",children:[(0,x.jsx)(d.Z.Label,{className:"fw-medium",children:"Produto Ativo"}),(0,x.jsx)(d.Z.Check,{type:"switch",id:"activo-switch",name:"activo",label:g.activo?"Sim (Dispon\xedvel para venda)":"N\xe3o (Indispon\xedvel para venda)",checked:g.activo,onChange:G,className:"mt-2"})]})})]})]})]}),(0,x.jsxs)("div",{className:"card border-0 shadow-sm rounded mb-4",children:[(0,x.jsx)("div",{className:"card-header bg-light py-2",children:(0,x.jsx)("h6",{className:"mb-0",children:"Imagem do Produto"})}),(0,x.jsx)("div",{className:"card-body pt-3",children:(0,x.jsxs)(u.Z,{children:[(0,x.jsx)(m.Z,{md:I?7:12,children:(0,x.jsxs)(d.Z.Group,{className:"mb-3",children:[(0,x.jsx)(d.Z.Label,{className:"fw-medium",children:"Upload de Imagem"}),(0,x.jsxs)("div",{className:"d-flex gap-2 mb-2",children:[(0,x.jsxs)(h.Z,{variant:"outline-primary",onClick:function(){F.current.click()},className:"d-flex align-items-center",children:[(0,x.jsx)("i",{className:"bi bi-upload me-2"}),"Selecionar Imagem"]}),I&&(0,x.jsxs)(h.Z,{variant:"outline-danger",onClick:function(){A(""),N((function(e){return b(b({},e),{},{image:""})})),z(null),F.current&&(F.current.value="")},className:"d-flex align-items-center",children:[(0,x.jsx)("i",{className:"bi bi-trash me-2"}),"Remover"]})]}),(0,x.jsx)("input",{type:"file",ref:F,onChange:function(e){var n=e.target.files[0];if(!n)return z(null),A(""),void N((function(e){return b(b({},e),{},{image:""})}));if(!n.type.match("image.*"))return P("Por favor, selecione apenas arquivos de imagem."),z(null),void A("");if(n.size>5242880)return P("A imagem selecionada \xe9 muito grande. O tamanho m\xe1ximo \xe9 5MB."),z(null),void A("");z(n);var t=new FileReader;t.onload=function(e){A(e.target.result)},t.readAsDataURL(n),P("")},accept:"image/*",className:"d-none"}),(0,x.jsx)(d.Z.Control,{type:"text",name:"image",value:g.image,onChange:G,placeholder:"URL da imagem (opcional)",className:"border-secondary-subtle"}),(0,x.jsx)(d.Z.Text,{className:"text-muted",children:"Selecione uma imagem do seu dispositivo ou insira uma URL"})]})}),I&&(0,x.jsx)(m.Z,{md:5,children:(0,x.jsxs)("div",{className:"mb-3",children:[(0,x.jsx)(d.Z.Label,{className:"fw-medium",children:"Preview"}),(0,x.jsx)("div",{className:"border rounded p-2 d-flex justify-content-center align-items-center bg-light",style:{height:"150px"},children:(0,x.jsx)("img",{src:I,alt:"Preview",style:{maxHeight:"140px",maxWidth:"100%",objectFit:"contain"},onError:function(e){e.target.onerror=null,e.target.src="https://via.placeholder.com/150x150?text=Erro+na+imagem"}})})]})})]})})]})]})}),(0,x.jsxs)(c.Z.Footer,{className:"border-top-0 pt-0",children:[(0,x.jsx)(h.Z,{variant:"light",onClick:t,disabled:w,className:"border",children:"Cancelar"}),(0,x.jsx)(h.Z,{variant:"primary",type:"submit",form:"productForm",disabled:_||w,className:"d-flex align-items-center",children:w?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(l.Z,{size:"sm",animation:"border",className:"me-2"}),s?"Atualizando...":"Salvando..."]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("i",{className:"bi bi-check-lg me-2"}),s?"Atualizar":"Salvar"]})})]})]})]})}},1387:function(e,n,t){t.d(n,{Z:function(){return p}});var r=t(6687),a=t(29),s=t(7794),o=t.n(s),i=t(7294),c=t(7066),l=t(538),d=t(1608),u=t(1555),m=t(2914),h=t(5893);function p(e){var n=e.onEdit,t=e.onProductSavedOrDeleted,s=(0,i.useState)([]),p=s[0],x=s[1],j=(0,i.useState)(!0),f=j[0],b=j[1],v=(0,i.useState)(null),g=v[0],N=v[1],y=(0,i.useState)(1),_=y[0],Z=y[1],w=(0,i.useState)(0),C=w[0],k=w[1],O=(0,i.useState)(""),S=O[0],E=O[1],q=(0,i.useState)(""),P=q[0],D=q[1],I=(0,i.useState)([]),A=I[0],F=I[1],L=(0,i.useCallback)((0,a.Z)(o().mark((function e(){var n,t,r,a,s,i,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),N(null),t=(n=10*(_-1))+10-1,r=c.O.from("produtos").select("\n        produto_id,\n        nome,\n        preco,\n        categoria,\n        image,\n        tipo_corte,\n        quantidade_estoque,\n        activo\n      ",{count:"exact"}),S&&(r=r.or("nome.ilike.%".concat(S,"%,categoria.ilike.%").concat(S,"%"))),P&&(r=r.eq("categoria",P)),e.next=9,r.order("produto_id",{ascending:!0}).range(n,t);case 9:a=e.sent,s=a.data,i=a.error,l=a.count,i?(console.error("Erro ao buscar produtos:",i),N("Erro ao carregar produtos.")):(x(s),k(l)),b(!1);case 15:case"end":return e.stop()}}),e)}))),[_,S,P]),T=(0,i.useCallback)((0,a.Z)(o().mark((function e(){var n,t,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.O.from("produtos").select("categoria",{distinct:!0}).not("categoria","is",null);case 2:n=e.sent,t=n.data,(a=n.error)?console.error("Erro ao buscar categorias:",a):(s=(0,r.Z)(new Set(t.map((function(e){return e.categoria})))).sort(),F([""].concat((0,r.Z)(s))));case 6:case"end":return e.stop()}}),e)}))),[]);function z(){return z=(0,a.Z)(o().mark((function e(n){var r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.confirm("Tem certeza que deseja excluir este produto?")){e.next=2;break}return e.abrupt("return");case 2:return b(!0),e.next=5,c.O.from("produtos").delete().eq("produto_id",n);case 5:r=e.sent,(a=r.error)?(console.error("Erro ao excluir produto:",a),N("Erro ao excluir produto.")):(console.log("Produto exclu\xeddo com sucesso:",n),1===p.length&&_>1?Z((function(e){return e-1})):L(),t()),b(!1);case 9:case"end":return e.stop()}}),e)}))),z.apply(this,arguments)}(0,i.useEffect)((function(){L()}),[L,t]),(0,i.useEffect)((function(){T()}),[T]);var G=Math.ceil(C/10),R=function(e){e>0&&e<=G&&Z(e)},M=(0,i.useCallback)(function(e,n){var t;return function(){for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];var o=this;clearTimeout(t),t=setTimeout((function(){return e.apply(o,a)}),n)}}((function(e){E(e),Z(1)}),300),[]);return(0,h.jsxs)("div",{className:"table-responsive",children:[(0,h.jsxs)(d.Z,{className:"mb-3 align-items-end",children:[(0,h.jsx)(u.Z,{md:5,children:(0,h.jsxs)(m.Z.Group,{children:[(0,h.jsx)(m.Z.Label,{className:"fw-medium",children:"Pesquisar Produto"}),(0,h.jsx)(m.Z.Control,{type:"text",placeholder:"Nome ou Categoria...",onChange:function(e){M(e.target.value)},value:S})]})}),(0,h.jsx)(u.Z,{md:4,children:(0,h.jsxs)(m.Z.Group,{children:[(0,h.jsx)(m.Z.Label,{className:"fw-medium",children:"Filtrar por Categoria"}),(0,h.jsxs)(m.Z.Select,{value:P,onChange:function(e){D(e.target.value),Z(1)},children:[(0,h.jsx)("option",{value:"",children:"Todas as Categorias"}),A.map((function(e){return(0,h.jsx)("option",{value:e,children:e},e)}))]})]})}),(0,h.jsxs)(u.Z,{md:3,className:"text-end",children:[(0,h.jsxs)("p",{className:"mb-0 fw-medium",children:["Total de Produtos: ",C]})," "]})]}),f?(0,h.jsx)(l.Z,{}):g?(0,h.jsx)("div",{className:"alert alert-danger",children:g}):0!==p.length||0!==C||S||P?0===p.length&&(S||P)?(0,h.jsx)("div",{className:"alert alert-info",children:"Nenhum produto encontrado para os filtros aplicados."}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("table",{className:"table table-striped",children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"ID"}),(0,h.jsx)("th",{children:"Nome"}),(0,h.jsx)("th",{children:"Pre\xe7o"}),(0,h.jsx)("th",{children:"Categoria"}),(0,h.jsx)("th",{children:"Tipo de Corte"}),(0,h.jsx)("th",{children:"Estoque"}),(0,h.jsx)("th",{children:"Ativo"}),(0,h.jsx)("th",{children:"A\xe7\xf5es"})]})}),(0,h.jsx)("tbody",{children:p.map((function(e){return(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{children:e.produto_id}),(0,h.jsx)("td",{children:e.nome}),(0,h.jsx)("td",{children:e.preco?"Kz ".concat(parseFloat(e.preco).toFixed(2)):"N/A"}),(0,h.jsx)("td",{children:e.categoria||"N/A"}),(0,h.jsx)("td",{children:e.tipo_corte||"N/A"}),(0,h.jsx)("td",{children:e.quantidade_estoque}),(0,h.jsx)("td",{children:e.activo?"Sim":"N\xe3o"}),(0,h.jsx)("td",{children:(0,h.jsxs)("div",{className:"btn-group",children:[(0,h.jsx)("button",{className:"btn btn-sm btn-primary",onClick:function(){return n(e)},children:"Editar"}),(0,h.jsx)("button",{className:"btn btn-sm btn-danger ms-1",onClick:function(){return function(e){return z.apply(this,arguments)}(e.produto_id)},children:"Excluir"})]})})]},e.produto_id)}))})]}),G>1&&(0,h.jsx)("nav",{"aria-label":"Product pagination",children:(0,h.jsxs)("ul",{className:"pagination justify-content-center",children:[(0,h.jsx)("li",{className:"page-item ".concat(1===_?"disabled":""),children:(0,h.jsx)("button",{className:"page-link",onClick:function(){return R(_-1)},disabled:1===_,children:"Anterior"})}),(0,r.Z)(Array(G)).map((function(e,n){return(0,h.jsx)("li",{className:"page-item ".concat(_===n+1?"active":""),children:(0,h.jsx)("button",{className:"page-link",onClick:function(){return R(n+1)},children:n+1})},n)})),(0,h.jsx)("li",{className:"page-item ".concat(_===G?"disabled":""),children:(0,h.jsx)("button",{className:"page-link",onClick:function(){return R(_+1)},disabled:_===G,children:"Pr\xf3ximo"})})]})})]}):(0,h.jsx)("div",{className:"alert alert-info",children:"Nenhum produto encontrado."})]})}},7066:function(e,n,t){t.d(n,{O:function(){return r}});var r=(0,t(6490).eI)("https://tmxloojyhptewicelujm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRteGxvb2p5aHB0ZXdpY2VsdWptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjA4NjgyMDYsImV4cCI6MjAzNjQ0NDIwNn0.9mYoFRr1Mlo02DD2haZ1jnKXA1_XCzkh9pMfMa2xVf0")}}]);